<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bihar Assembly Election Candidates 2025</title>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-R77D038ENB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-R77D038ENB');
  </script>
  
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background: #f9fafb; }
    select, table { margin-top: 1em; }
    select { padding: 0.5em; font-size: 1em; }
    table { border-collapse: collapse; width: 90%; background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f1f1f1; }
    .filters { display: flex; gap: 1em; align-items: center; flex-wrap: wrap; }
  </style>
</head>
<body>
  <h2>Bihar Election Data Viewer 2025</h2>

  <div class="filters">
    <div>
      <label for="partyDropdown">Select Party:</label><br>
      <select id="partyDropdown">
        <option value="">-- Select a Party --</option>
        <option value="bjp">BJP</option>
        <option value="congress">Congress</option>
        <option value="aap">AAP</option>
        <option value="jdu">JDU</option>
        <option value="ljp">LOJPA</option>
        <option value="rjd">RJD</option>
        <option value="jsp">Jan Suraj Party</option>
      </select>
    </div>

    <div>
      <label for="constDropdown">Select Constituency:</label><br>
      <select id="constDropdown">
        <option value="">-- Select Constituency --</option>
      </select>
    </div>
  </div>

  <div id="result"></div>
  <br><br>
  <!-- Visitor Counter -->
    <div id="visitorCounter">
      üëÅÔ∏è Visitors Count: <span id="visits">‚Äî</span>
    </div>
	  </div>
	  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
  const partyDropdown = document.getElementById('partyDropdown');
  const constDropdown = document.getElementById('constDropdown');
  const result = document.getElementById('result');

  const allData = {};
  const parties = ['bjp', 'congress', 'aap', 'jdu', 'ljp', 'rjd', 'jsp'];

  Promise.all(parties.map(p =>
    fetch(`data/${p}.json`)
      .then(res => res.ok ? res.json() : [])
      .then(candidates => {
        // attach party to each candidate so constituency search shows party too
        allData[p] = (candidates || []).map(c => ({ ...c, party: p }));
      })
  )).then(() => {
    console.log('‚úÖ All party data loaded');
    populateConstituencies();
  });

  // Function to populate constituency dropdown
  function populateConstituencies() {
    const allCandidates = Object.values(allData).flat();

    // Trim spaces and remove duplicates
    const constituencies = [
      ...new Set(allCandidates.map(c => c.constituency.toString().trim()))
    ].sort();

    constituencies.forEach(c => {
      const option = document.createElement('option');
      option.value = c;
      option.textContent = c;
      constDropdown.appendChild(option);
    });
  }

  // Show candidates by selected party
  partyDropdown.addEventListener('change', () => {
    const party = partyDropdown.value;
    if (!party) { result.innerHTML = ''; return; }

    showCandidates(allData[party], `${party.toUpperCase()} Candidates`, party);
    constDropdown.value = '';
  });

  // Show candidates by selected constituency
  constDropdown.addEventListener('change', () => {
    const constituency = constDropdown.value;
    if (!constituency) { result.innerHTML = ''; return; }

    const matches = [];
    for (const candidates of Object.values(allData)) {
      candidates.forEach(c => {
        if (String(c.constituency).trim().toLowerCase() === constituency.trim().toLowerCase()) {
          matches.push(c); // keep all matching entries
        }
      });
    }

    showCandidates(matches, `Candidates in ${constituency}`, null);
    partyDropdown.value = '';
  });

  // Function to display candidates in a table
  function showCandidates(candidates, title, selectedParty) {
    if (!candidates || candidates.length === 0) {
      result.innerHTML = `<p style="color:red;">No data found.</p>`;
      return;
    }

    let html = `<h3>${title}</h3>`;
    html += `<table>
              <tr>
                <th>Candidate</th>
                <th>Party</th>
                <th>Constituency</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Votes</th>
              </tr>
              ${candidates.map(c => `
                <tr>
                  <td>${c.name || '-'}</td>
                  <td>${(c.party || selectedParty || '-').toString().toUpperCase()}</td>
                  <td>${c.constituency || '-'}</td>
                  <td>${c.age ?? '-'}</td>
                  <td>${c.gender || '-'}</td>
                  <td>${c.votes ?? '-'}</td>
                </tr>`).join('')}
            </table>`;
    result.innerHTML = html;
  }
  
      // ==============================
    // Firebase Visitor Counter
    // ==============================
    const visitsEl = document.getElementById("visits");

    const firebaseConfig = {
  apiKey: "***REMOVED***",
  authDomain: "bihar2025-c84e8.firebaseapp.com",
  databaseURL: "https://bihar2025-c84e8-default-rtdb.firebaseio.com",
  projectId: "bihar2025-c84e8",
  storageBucket: "bihar2025-c84e8.firebasestorage.app",
  messagingSenderId: "8599541523",
  appId: "1:8599541523:web:137de758b9d58052faace6",
  measurementId: "G-Y8NBG6BQS5"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const counterKey = "bihar_assembly_visits";
    const startingValue = 500;

    const counterRef = db.ref("counters/" + counterKey);

    counterRef.get().then(snapshot => {
      if (snapshot.exists()) {
        const value = snapshot.val() + 1;
        counterRef.set(value);
        visitsEl.innerText = value;
      } else {
        counterRef.set(startingValue);
        visitsEl.innerText = startingValue;
      }
    }).catch(err => {
      console.error("Visitor counter error:", err);
      visitsEl.innerText = "‚Äî";
    });
  </script>
</body>
</html>
